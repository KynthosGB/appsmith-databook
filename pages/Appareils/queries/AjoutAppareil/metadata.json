{
  "gitSyncId": "6900ce0e5fba93519b2b9c51_298255f6-059d-4347-bffe-4d88262e239b",
  "id": "Appareils_AjoutAppareil",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "BEGIN;\n\nWITH params AS (\n  SELECT\n    '{{ appsmith.URL.queryParams.numero_affaire + InputRepereAppareil.text }}'::text AS num_app,\n    '{{ appsmith.URL.queryParams.numero_affaire }}'::text                        AS num_aff,\n    '{{ InputNomAppareil.text }}'::text                                          AS nom_appareil,\n    '{{ InputRepereAppareil.text }}'::text                                       AS repere\n)\n\n-- 1) appareils\nINSERT INTO public.appareils (numero_appareil, numero_affaire)\nSELECT num_app, num_aff FROM params\nON CONFLICT (numero_appareil) DO NOTHING;\n\n-- 2) caracteristiques_appareils\nINSERT INTO public.caracteristiques_appareils (numero_appareil, numero_affaire, nom_appareil, repere_appareil)\nSELECT p.num_app, p.num_aff, p.num_aff || ' - ' || p.nom_appareil, p.repere\nFROM params p\nON CONFLICT (numero_appareil) DO NOTHING;\n\n-- 3) donnees_generales_appareils\nINSERT INTO public.donnees_generales_appareils (numero_appareil, numero_affaire, nom_client, nom_affaire)\nSELECT p.num_app, p.num_aff, a.nom_client, p.num_aff\nFROM params p\nJOIN public.affaires a ON a.numero_affaire = p.num_aff\nON CONFLICT (numero_appareil) DO NOTHING;\n\n-- 4) synchro du sommaire pour l'appareil nouvellement créé\nSELECT public.sync_sommaire_appareil((SELECT num_app FROM params));\n\nCOMMIT;",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "Databook - Neon",
      "isAutoGenerated": false,
      "name": "Databook - Neon",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "AjoutAppareil",
    "pageId": "Appareils",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": true
  }
}