SELECT
  wgh.id,
  wgh.groupe_appareil_id,
  wgh.numero_appareil,
  wgh.groupe_id,
  wge.code        AS groupe_code,
  wge.libelle     AS groupe_libelle,

  ws.id           AS statut_id,
  ws.code         AS statut_code,
  ws.libelle      AS statut_libelle,
  ws.couleur      AS statut_couleur,

  wgh.date_debut,
  wgh.date_fin,
  wgh.date_envoi_client,
  wgh.date_retour_client,
  wgh.responsable,
  wgh.commentaire,
  wgh.meta,
  wgh.changed_at,
  wgh.changed_by

FROM public.workflow_groupe_appareil_history wgh
JOIN public.workflow_groupe_etape           wge ON wge.id = wgh.groupe_id
JOIN public.workflow_statut                 ws  ON ws.id  = wgh.statut_id

WHERE wgh.groupe_appareil_id = {{ appsmith.store.selectedStep?.groupe_appareil_id || 0 }}

ORDER BY wgh.changed_at DESC;
