INSERT INTO public.revue_de_contrat_appareil (
  numero_appareil,
  numero_devis,
  date_devis,
  numero_appel_doffre,
  date_appel_doffre,
  plan_ensemble,
  taille_piquages,
  dim_pos_tubulures,
  orifices,
  plans_de_detail,
  materiaux_appareils,
  valeur_surepaisseur_corrosion,
  temp_min_max,
  press_min_max,
  materiaux_nace_asme,
  mdmt,
  materiaux_joints,
  materiaux_boulonneries,
  materiaux_caracteristiques_tubes,
  couple_temp_press,
  nature_et_etat_fluide,
  actions_vent_neige_seisme,
  efforts_piquages,
  autres_sollicitations_ext,
  donnees_relatives_variation_soll,
  position_appareil,
  nature_fluide_utilise,
  sollicitations_essais,
  sollicitations_transport_montage,
  code_calcul,
  tolerances_particulieres,
  traitement_thermique_specifique,
  protection_surfaces_internes,
  protection_surfaces_externes,
  cahier_de_soudage,
  qualif_soudeurs_supp,
  controle_radio_pourcentage,
  controle_ressuage_pourcentage,
  organisme_controle_non_destructif,
  inspection_fat,
  pmi,
  test_helium,
  controle_ultrason,
  points_zero,
  pression_essai_hydrostatique,
  fourniture_livraison_appareil,
  instruments_accessoires,
  pieces_de_rechange,
  plan_qualite,
  emballage_berces,
  emballage_caisse_bois,
  isolation_calorifugeage,
  plateforme,
  echelle,
  agitation,
  mode_transport,
  incoterme,
  contrainte_transport,
  protection_appareil,
  emballage_appareil,
  contraintes_installation_site,
  remplissage_colonne,
  supervision_installation,
  supervision_mise_en_service,
  montage_site,
  dechargement_site,
  montant_commande,
  nombre_heures_devis,
  date_livraison_prev,
  penalite_retard_livraison
)
VALUES (
  {{ appsmith.URL.queryParams.numero_appareil }},

  {{ NumDevis.text }},
  {{ DateDevis.selectedDate ? moment(DateDevis.selectedDate).format("YYYY-MM-DD") : null }},
  {{ NumAppelDoffreClient.text }},
  {{ DateAppelDoffreClient.selectedDate ? moment(DateAppelDoffreClient.selectedDate).format("YYYY-MM-DD") : null }},

  {{ PlanEnsemble.text }},
  {{ TaillePiquages.text }},
  {{ DimEtPosTubulures.text }},
  {{ Orifices.text }},
  {{ PlansDeDetail.text }},

  {{ MateriauxAppareil.text }},
  {{ ValSurepCorr.text }},
  {{ TempMinMax.text }},
  {{ PressMinMax.text }},
  {{ MateriauxNaceAsme.text }},
  {{ MDMT.text }},
  {{ MateriauxJoints.text }},
  {{ MateriauxBoul.text }},
  {{ MateriauxCaracTubes.text }},
  {{ CoupleTempPress.text }},

  {{ NatureFluideEtEtat.text }},
  {{ ActionsVentNeigeSeisme.text }},
  {{ EffortsPiquages.text }},
  {{ AutresSollExt.text }},
  {{ DonneesRelVarSoll.text }},
  {{ PositionAppareil.text }},
  {{ NatureFluideUtilise.text }},
  {{ SollEssais.text }},
  {{ SollTransportMontage.text }},

  {{ CodeCalcul.text }},
  {{ TolerancesParticulieres.text }},
  {{ TraitementThermiqueSpecifique.text }},
  {{ ProtectionSurfacesInternes.text }},
  {{ ProtectionSurfacesExternes.text }},

  {{ CahierSoudage.text }},
  {{ QualifSoudeurSupp.text }},
  {{ ControleRadioEtPourc.text }},
  {{ ControleRessuageEtPourc.text }},
  {{ OrganismeControleNonDestru.text }},
  {{ InspectionFat.text }},
  {{ PMI.text }},
  {{ TestHelium.text }},
  {{ ControleUltrason.text }},
  {{ PointsZero.text }},
  {{ PressionEssaiHydro.text }},

  {{ FournitureALivrer.text }},
  {{ InstrumentsAccessoires.text }},
  {{ PiecesRechange.text }},
  {{ PlanQualite.text }},
  {{ EmballageBerces.text }},
  {{ EmballageCaisseBois.text }},
  {{ IsoCalo.text }},
  {{ Plateforme.text }},
  {{ Echelle.text }},
  {{ Agitation.text }},

  {{ ModeTransport.text }},
  {{ Incoterme.text }},
  {{ ContrainteTransport.text }},
  {{ ProtectionAppareil.text }},
  {{ EmballageAppareil.text }},
  {{ ContraintesInstallSite.text }},
  {{ RemplissageColonne.text }},
  {{ SupervisionInstall.text }},
  {{ SupervisionMiseEnService.text }},
  {{ MontageSite.text }},
  {{ DechargementSite.text }},

  {{ MontantCommande.value }},
  {{ NbHeuresDevis.text }},
  {{ DateLivraisonPrev.selectedDate ? moment(DateLivraisonPrev.selectedDate).format("YYYY-MM-DD") : null }},
  {{ PenaliteRetard.text }}
)
ON CONFLICT (numero_appareil)
DO UPDATE SET
  numero_devis                      = EXCLUDED.numero_devis,
  date_devis                        = EXCLUDED.date_devis,
  numero_appel_doffre               = EXCLUDED.numero_appel_doffre,
  date_appel_doffre                 = EXCLUDED.date_appel_doffre,
  plan_ensemble                     = EXCLUDED.plan_ensemble,
  taille_piquages                   = EXCLUDED.taille_piquages,
  dim_pos_tubulures                 = EXCLUDED.dim_pos_tubulures,
  orifices                          = EXCLUDED.orifices,
  plans_de_detail                   = EXCLUDED.plans_de_detail,
  materiaux_appareils               = EXCLUDED.materiaux_appareils,
  valeur_surepaisseur_corrosion     = EXCLUDED.valeur_surepaisseur_corrosion,
  temp_min_max                      = EXCLUDED.temp_min_max,
  press_min_max                     = EXCLUDED.press_min_max,
  materiaux_nace_asme               = EXCLUDED.materiaux_nace_asme,
  mdmt                              = EXCLUDED.mdmt,
  materiaux_joints                  = EXCLUDED.materiaux_joints,
  materiaux_boulonneries            = EXCLUDED.materiaux_boulonneries,
  materiaux_caracteristiques_tubes  = EXCLUDED.materiaux_caracteristiques_tubes,
  couple_temp_press                 = EXCLUDED.couple_temp_press,
  nature_et_etat_fluide             = EXCLUDED.nature_et_etat_fluide,
  actions_vent_neige_seisme         = EXCLUDED.actions_vent_neige_seisme,
  efforts_piquages                  = EXCLUDED.efforts_piquages,
  autres_sollicitations_ext         = EXCLUDED.autres_sollicitations_ext,
  donnees_relatives_variation_soll  = EXCLUDED.donnees_relatives_variation_soll,
  position_appareil                 = EXCLUDED.position_appareil,
  nature_fluide_utilise             = EXCLUDED.nature_fluide_utilise,
  sollicitations_essais             = EXCLUDED.sollicitations_essais,
  sollicitations_transport_montage  = EXCLUDED.sollicitations_transport_montage,
  code_calcul                       = EXCLUDED.code_calcul,
  tolerances_particulieres          = EXCLUDED.tolerances_particulieres,
  traitement_thermique_specifique   = EXCLUDED.traitement_thermique_specifique,
  protection_surfaces_internes      = EXCLUDED.protection_surfaces_internes,
  protection_surfaces_externes      = EXCLUDED.protection_surfaces_externes,
  cahier_de_soudage                 = EXCLUDED.cahier_de_soudage,
  qualif_soudeurs_supp              = EXCLUDED.qualif_soudeurs_supp,
  controle_radio_pourcentage        = EXCLUDED.controle_radio_pourcentage,
  controle_ressuage_pourcentage     = EXCLUDED.controle_ressuage_pourcentage,
  organisme_controle_non_destructif = EXCLUDED.organisme_controle_non_destructif,
  inspection_fat                    = EXCLUDED.inspection_fat,
  pmi                               = EXCLUDED.pmi,
  test_helium                       = EXCLUDED.test_helium,
  controle_ultrason                 = EXCLUDED.controle_ultrason,
  points_zero                       = EXCLUDED.points_zero,
  pression_essai_hydrostatique      = EXCLUDED.pression_essai_hydrostatique,
  fourniture_livraison_appareil     = EXCLUDED.fourniture_livraison_appareil,
  instruments_accessoires           = EXCLUDED.instruments_accessoires,
  pieces_de_rechange                = EXCLUDED.pieces_de_rechange,
  plan_qualite                      = EXCLUDED.plan_qualite,
  emballage_berces                  = EXCLUDED.emballage_berces,
  emballage_caisse_bois             = EXCLUDED.emballage_caisse_bois,
  isolation_calorifugeage           = EXCLUDED.isolation_calorifugeage,
  plateforme                        = EXCLUDED.plateforme,
  echelle                           = EXCLUDED.echelle,
  agitation                         = EXCLUDED.agitation,
  mode_transport                    = EXCLUDED.mode_transport,
  incoterme                         = EXCLUDED.incoterme,
  contrainte_transport              = EXCLUDED.contrainte_transport,
  protection_appareil               = EXCLUDED.protection_appareil,
  emballage_appareil                = EXCLUDED.emballage_appareil,
  contraintes_installation_site     = EXCLUDED.contraintes_installation_site,
  remplissage_colonne              = EXCLUDED.remplissage_colonne,
  supervision_installation          = EXCLUDED.supervision_installation,
  supervision_mise_en_service       = EXCLUDED.supervision_mise_en_service,
  montage_site                      = EXCLUDED.montage_site,
  dechargement_site                 = EXCLUDED.dechargement_site,
  montant_commande                  = EXCLUDED.montant_commande,
  nombre_heures_devis               = EXCLUDED.nombre_heures_devis,
  date_livraison_prev               = EXCLUDED.date_livraison_prev,
  penalite_retard_livraison         = EXCLUDED.penalite_retard_livraison,
  updated_at                        = NOW()
RETURNING *;
