SELECT
  ar.id,
  ar.event_type,

  ar.step_code,
  wge.libelle AS step_label,

  ar.status_code,
  ws.libelle AS status_label,

  ar.event_key,
  ar.event_value,

  ar.target_everwin_user_id,
  eu.display_name AS target_everwin_name,

  ar.enabled,
  ar.description,
  ar.throttle_minutes,
  ar.only_on_change
FROM public.alert_rules ar
LEFT JOIN public.workflow_groupe_etape wge ON wge.code = ar.step_code
LEFT JOIN public.workflow_statut ws ON ws.code = ar.status_code
LEFT JOIN public.everwin_users eu ON eu.everwin_user_id = ar.target_everwin_user_id
ORDER BY ar.event_type, wge.ordre NULLS LAST, ws.ordre NULLS LAST, eu.display_name NULLS LAST;
