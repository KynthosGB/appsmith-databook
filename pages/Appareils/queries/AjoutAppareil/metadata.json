{
  "gitSyncId": "6900ce0e5fba93519b2b9c51_298255f6-059d-4347-bffe-4d88262e239b",
  "id": "Appareils_AjoutAppareil",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "WITH params AS (\n  SELECT\n    '{{ appsmith.URL.queryParams.numero_affaire + InputRepereAppareil.text }}'::text AS num_app,\n    '{{ appsmith.URL.queryParams.numero_affaire }}'::text                            AS num_aff,\n    '{{ InputNomAppareil.text }}'::text                                              AS nom_appareil,\n    '{{ InputRepereAppareil.text }}'::text                                           AS repere\n),\nins_app AS (\n  INSERT INTO public.appareils (numero_appareil, numero_affaire)\n  SELECT num_app, num_aff FROM params\n  ON CONFLICT (numero_appareil) DO NOTHING\n  RETURNING 1\n),\nins_carac AS (\n  INSERT INTO public.caracteristiques_appareils (numero_appareil, numero_affaire, nom_appareil, repere_appareil)\n  SELECT p.num_app, p.num_aff, p.num_aff || ' - ' || p.nom_appareil, p.repere\n  FROM params p\n  ON CONFLICT (numero_appareil) DO NOTHING\n  RETURNING 1\n),\nins_dg AS (\n  INSERT INTO public.donnees_generales_appareils (numero_appareil, numero_affaire, nom_client, nom_affaire)\n  SELECT p.num_app, p.num_aff, a.nom_client, p.num_aff\n  FROM params p\n  JOIN public.affaires a ON a.numero_affaire = p.num_aff\n  ON CONFLICT (numero_appareil) DO NOTHING\n  RETURNING 1\n),\nsync AS (\n  SELECT public.sync_sommaire_appareil((SELECT num_app FROM params)) AS synced\n)\nSELECT\n  (SELECT COALESCE(COUNT(*),0) FROM ins_app)   AS app_inserted,\n  (SELECT COALESCE(COUNT(*),0) FROM ins_carac) AS carac_inserted,\n  (SELECT COALESCE(COUNT(*),0) FROM ins_dg)    AS dg_inserted,\n  (SELECT synced FROM sync)                    AS sommaire_synced;\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "Databook - Neon",
      "isAutoGenerated": false,
      "name": "Databook - Neon",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "AjoutAppareil",
    "pageId": "Appareils",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": true
  }
}